<div class="d-flex justify-content-center">
    <div class="d-flex flex-column w-75">
        <div class="d-flex flex-row w-100">
            <div class="playerOneSucces w-50 my-border-bottom">
                <span>@CurrentMatch.PlayerOne.FirstName @CurrentMatch.PlayerOne.LastName</span>
                @if (ShowButtons)
                {
                    <input type="button" class="btn btn-primary ms-1" value="Set player as active" @onclick="e => SetActivePlayer(CurrentMatch.PlayerOne)" />
                }
                </div>
            <div class="number-empty my-border-bottom"></div>
            <div class="playerTwoSucces w-50 ps-2 my-border-bottom">
                <span>@CurrentMatch.PlayerTwo.FirstName @CurrentMatch.PlayerTwo.LastName</span>
                @if (ShowButtons)
                {
                    <input type="button" class="btn btn-primary ms-1" value="Set player as active" @onclick="e => SetActivePlayer(CurrentMatch.PlayerTwo)" />
                }
            </div>
        </div>
        @if (CurrentMatch != null)
        {
            @foreach (var number in AllPosibleThrow)
            {

                <div class="d-flex flex-row">
                    <div class="playerOneSucces w-50">@CheckThrows(CurrentMatch.PlayerOne, number.Single)</div>
                    <div class="number text-center">@number.Single.Score</div>
                    <div class="playerTwoSucces w-50 ps-1">@CheckThrows(CurrentMatch.PlayerTwo, number.Single)</div>
                </div>
            }}
        <div class="d-flex flex-row">
            <div class="playerOneSucces w-50">@CheckThrows(CurrentMatch.PlayerOne, PosibleBullThrows[0])</div>
            <div class="number text-center">Bull</div>
            <div class="playerTwoSucces w-50 ps-1">@CheckThrows(CurrentMatch.PlayerTwo, PosibleBullThrows[0])</div>
        </div>
        <div class="mt-2 my-border-bottom"><h5>Score</h5></div>
        <div class="d-flex flex-row w-100 pb-2">
            <div class="w-50">@CurrentMatch.PlayerOne.Score</div>
            <div class="w-50 ps-5">@CurrentMatch.PlayerTwo.Score</div>
        </div>

    </div>
</div>


@code {
    [Parameter]
    public DartsMatchModel CurrentMatch { get; set; }
    [Parameter]
    public List<ScoresPerNumberModel> AllPosibleThrow { get; set; }
    [Parameter]
    public List<ScoreModel> PosibleBullThrows { get; set; }
    [Parameter]
    public bool ShowButtons { get; set; } = true;


    protected override void OnParametersSet()
    {
        base.OnParametersSet();

    }
    private void SetActivePlayer(DartsPlayerModel playerToBeActive)
    {
        playerToBeActive.IsActiveTurn = true;
        var playerToBeDeactivated = CurrentMatch.PlayerOne == playerToBeActive ?  CurrentMatch.PlayerTwo : CurrentMatch.PlayerOne;
        playerToBeDeactivated.IsActiveTurn = false;

    }

    private MarkupString CheckThrows(DartsPlayerModel player,ScoreModel number)
    {
        var allThrowsOfPlayer = player.Throws.OrderBy(t => t.TimeStamp).ToList();
        var amountOfHits = 0;
        MarkupString result = new();

        for (int i = 0; i < allThrowsOfPlayer.Count; i++)
        {
            var allThrowOfNumber = player.Throws.Where(t => t.BaseNumber == number.BaseScore).ToList();
            int total = allThrowOfNumber.Sum(a => a.Throw);
            amountOfHits = total / number.BaseScore;

            switch (amountOfHits)
            {
                case 0: result = (MarkupString) "<span></span>"; break;
                case 1: result = (MarkupString) "<i class=\"fas fa-slash\"></i>"; break;
                case 2: result = (MarkupString) "<i class=\"fas fa-times ps-1\"></i>"; break;
                default: result = (MarkupString)"<i class=\"far fa-times-circle\"></i>";break;
            }
        }

        return result;

    }





}
